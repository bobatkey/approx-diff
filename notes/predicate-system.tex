\subsection{Predicate systems}
\label{sec:predicate-system}

\subsubsection{Predicate system over $\cat{C}$}

Suppose $\cat{C}$ a category with finite products. A \emph{predicate system} over $\cat{C}$ consists of the
following data:
\begin{itemize}
\item For every object $X$ of $\cat{C}$, a poset $(\Pred(X), \sqsubseteq)$ of predicates on $X$.
\item For every $X$, the structure of a Heyting algebra (without $\bot$) on $\Pred(X)$, i.e.~ top element
   $\top$, meets $\meet$, joins $\join$ and residual $\residual$ satisfying the usual laws.
\item For every morphism $f: X \to Y$ of $\cat{C}$, a Galois connection $\directImage{-}{f} \dashv
\reindex{-}{f} : \Pred(Y) \to \Pred(X)$. The right adjoint $\reindex{-}{f}: \Pred(Y) \to \Pred(X)$ computes
the pullback (reindexing) of a predicate along $f$; the left adjoint $\directImage{-}{f}: \Pred(X) \to
\Pred(Y)$ computes the pushforward (existential image) of a predicate along $f$, with the adjointness property
meaning that
\[\directImage{P}{f} \sqsubseteq Q \iff P \sqsubseteq \reindex{Q}{f} \]
\item For every $X$ and $Y$, a right adjoint $\forall_Y: \Pred(X \times Y) \to \Pred(X)$ to the monotone map
$\reindex{-}{\pi_1}$ called \emph{universal quantification}. \todo{Is there a left adjoint $\exists_Y$?}
\item $\reindex{-}{f}$ is colax (and thus $\directImage{-}{f}$ is lax) with respect to $\top$, $\meet$,
$\residual$ and $\forall_Y$.
\item $\reindex{-}{f}$ is lax (and thus $\directImage{-}{f}$ is colax) with respect to $\join$.
\end{itemize}

\subsubsection{Predicate system over $\Set$}

Suppose $X$ a set. Define a \emph{predicate on $X$} to be a family of (proof-irrelevant) propositions for
every $x \in X$. For any function $f: X \to Y$, define $\reindex{P}{f}(x)$ iff $P(f(x))$ and
$\directImage{P}{f}(y)$ iff there exists $x$ such that $f(x) = y$ and $P(x)$. Define $\mathcal{S}$ to be the
predicate system over $\Set$ which assigns to any set $X$ the set $\Pred(X)$ of propositions on $X$ ordered by
implication, with $\top, \meet, \join$ and $\residual$ defined pointwise and universal quantification defined
as $\forall_Y(P)(x)$ iff $P(x,y)$ for all $y \in Y$.

\subsubsection{Predicates on a presheaf}

Suppose $\cat{C}$ a category and $F: \cat{C}^\op \to \Set$ a presheaf. Define a \emph{predicate on $F$} to be
a family of predicates $P_X \in \Pred_\mathcal{S}(F(X))$ for every object $X$ in $\cat{C}$ such that $P_Y
\sqsubseteq \reindex{P_X}{F(f)}$ for every $f: X \to Y$ in $\cat{C}$.

Now define the predicate system $\mathcal{S}^{\cat{C}}$ over $\Func{\cat{C}^\op}{\Set}$ which assigns to every
presheaf $F$ the poset $\Pred(F)$ of predicates on $F$ ordered pointwise, where $\top, \meet, \join,
\residual$ and $\forall$ in $\Pred(F)$ are all given pointwise, and to every natural transformation $\alpha: F
\to G$, families of pullback and pushforward maps where $\reindex{P}{\alpha}_X = \reindex{P_X}{\alpha_X}$ and
$\directImage{P}{\alpha}_X = \directImage{P_X}{\alpha_X}$.

\subsubsection{Closure operator over a predicate system}

A \emph{closure operator} $C$ over a poset $(X, \sqleq)$ is a lax idempotent monad on $X$, with functoriality,
unit and multiplication given by monotonicity, extensivity ($x \sqleq C(x)$) and idempotence ($C(C(x)) \sqleq
C(x)$). Suppose $\mathcal{S} = (\Pred, \top, \meet, \join, \residual, \forall)$ a predicate system over a
category $\cat{C}$. A closure operator $C$ over $\mathcal{S}$ is a fibred lax idempotent monad $C$ on the
fibration $\Pred: \cat{C}^\op \to \Poset$ such that:
\begin{enumerate}
\item for every object $X$ in $\cat{C}$ the fibre map $C_X: \Pred(X) \to \Pred(X)$ is a closure operator;
\item
\item $C$ is lax monoidal with respect to $\meet$;
\item $C$ is lax strong, i.e.~$C(X \times Y) \sqleq X \times C(Y)$.
\end{enumerate}
That $C$ is fibred means that it commutes with the reindexing functor $\reindex{-}{f}$, i.e.~$C_X \comp
\reindex{-}{f}$ is naturally isomorphic to $\reindex{-}{f} \comp C_Y$.
