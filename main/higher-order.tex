\section{Interpreting Higher-Order Programs}
\label{sec:higher-order}

\todo{
\begin{enumerate}
\item if $\cat{C}$ has biproducts and all small products then $\Fam(\cat{C})$ is Cartesian closed
\item $\PSh(\cat{C})$ has all small products (inherited from $\Set$)
\item $\FinVect$ and $\LatGal$ have biproducts but not all small products
\item but actually we need $\PSh_{\CMon}(\cat{C})$ rather than $\PSh(\cat{C})$ because $\CMon$-enriched Yoneda embedding preserves biproducts
\end{enumerate}
}

\subsection{Biproducts and Semi-Additive Categories}
\label{sec:biproducts}

We noted that $\LatGal$ is enriched in $\SemiLat$, the category of semilattices, and moreover that the product
of lattices is also a coproduct, making $\LatGal$ into a category with \emph{biproducts}. In fact the presence
of biproducts is sufficient for enrichment in $\CMon$, the category of commutative monoids (including
semilattices); such a category is called \emph{semi-additive}.

\begin{definition}[Semi-additive category]
\label{def:biproducts:semi-additive}
A category with finite products and coproducts is \emph{semi-additive} if the canonical morphisms (projections
and injections) give an isomorphism
\[\textstyle X \coprod Y \iso X \times Y\] that is natural in both variables.
\end{definition}

The product/coproduct is called a \emph{biproduct}, with the biproduct structure denoted by $(\biprod, 0)$ and
projections $\biproj_X, \biproj_Y$ and injections $\biinj_X$ and $\biinj_Y$. The unit $0$ is both terminal and
initial and is called a \emph{zero} object. A semi-additive category $\cat{C}$ is enriched in $\CMon$: for any
two morphisms $f, g: X \to Y$ in $\cat{C}$, the biproduct structure provides a way to ``add'' them together,
forming a morphism $f + g: X \to Y$. Diagrammatically:

\begin{center}
\begin{tikzcd}
   X \arrow[r, "\diag"] & X \biprod X \arrow[r, "f \biprod g"] & Y \biprod Y \arrow[r, "\codiag"] & Y
\end{tikzcd}
\end{center}

Here $\diag$ denotes the diagonal $\prodM{\id_X}{\id_X}$ given by the universal property of the product and
$\codiag$ denotes the codiagonal $\coprodM{\id_X}{\id_Y}$ given by the universal property of the coproduct.
The $f \oplus g$ morphism is the component-wise map $\prodM{f \comp \biproj_X}{g \comp \biproj_Y} =
\coprodM{\biinj_X \comp f}{\biinj_Y \comp g}$. Similarly we can exhibit a \emph{zero} morphism $0_{X,Y}$ by
composing the unique maps in and out of the zero object:

\begin{center}
\begin{tikzcd}
   X \arrow[r, "!_X"] & 0 \arrow[r, "!^Y"] & Y
\end{tikzcd}
\end{center}

It is easy to verify that $+$ is associative and commutative and that $f + 0_{X,Y} = f$, and thus that every
hom-object $\cat{C}(X,Y)$ is an object in $\CMon$. Moreover composition is \emph{bilinear}, i.e.~given by a
family of morphisms $\Hom{\cat{C}}{Y}{Z} \tensor \Hom{\cat{C}}{X}{Y} \to \Hom{\cat{C}}{X}{Z}$ in $\CMon$ that
preserve the additive structure in $\Hom{\cat{C}}{Y}{Z}$ and $\Hom{\cat{C}}{X}{Y}$ separately:

\begin{salign*}
f \comp \zero_{X,Y} = 0_{X,Z} = \zero_{Y,Z} \comp f
\end{salign*}
\begin{salign*}
(f + g) \comp h &= (f \comp h) + (g \comp h) \\
h \comp (f + g) &= (h \comp f) + (h \comp g)
\end{salign*}

\subsubsection{Biproduct laws}
It is also easy to show that in a semi-additive category, as defined in \defref{biproducts:semi-additive}, the
following equations hold:

\vspace{-3mm}
\begin{minipage}[t]{0.45\textwidth}
\begin{center}
\begin{salign*}
   \biproj_X \comp \biinj_X &= \id_X \\
   \biproj_Y \comp \biinj_X &= \zero_{X,Y}
\end{salign*}
\end{center}
\end{minipage}%
\begin{minipage}[t]{0.45\textwidth}
\begin{center}
\begin{salign*}
   \biproj_Y \comp \biinj_Y &= \id_Y \\
   \biproj_X \comp \biinj_Y &= \zero_{Y,X}
\end{salign*}
\end{center}
\end{minipage}

\noindent and

\begin{salign*}
(\biinj_X \comp \biproj_X) + (\biinj_Y \comp \biproj_Y) &= \id_{X \biprod Y}
\end{salign*}

We can alternatively take these to be the defining equations of a biproduct $(X \biprod Y, \biproj_X,
\biproj_Y, \biinj_X, \biinj_Y)$ in any category $\cat{C}$ known to be $\CMon$-enriched, and therefore
providing addition of morphisms; in that case any products or coproducts in $\cat{C}$ are necessarily
biproducts.

\begin{proposition}
\label{prop:biproducts:from-product-or-coproduct}
Suppose $\cat{C}$ is $\CMon$-enriched.
\begin{enumerate}
\item If $(X \times Y, \pi_1, \pi_2)$ is a product in $\cat{C}$ then $(X \times Y, \biinj_X, \biinj_Y, \proj_1, \proj_2)$
is a biproduct, where $\biinj_X = \prodM{\id_X}{0_{X,Y}}: X \to X \times Y$ and $\biinj_Y =
\prodM{0_{X,Y}}{\id_Y}: Y \to X \times Y$.
\item If $(X \coprod Y, \inj_1, \inj_2)$ is a coproduct in $\cat{C}$ then $(X \coprod Y, \inj_1, \inj_2,
\biproj_X, \biproj_Y)$ is a biproduct, where $\biproj_X = \coprodM{\id_X}{0_{Y,X}}: X \coprod Y \to X$ and
$\biproj_Y = \coprodM{0_{X,Y}}{\id_Y}: X \coprod Y \to Y$.
\item If $X$ is terminal (or initial) in $\cat{C}$ then it is a zero object.
\end{enumerate}
\end{proposition}
